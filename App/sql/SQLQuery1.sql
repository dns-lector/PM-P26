CREATE TABLE Realties (
	Id UNIQUEIDENTIFIER PRIMARY KEY,
	Name NVARCHAR(256)
);

DROP TABLE Feedbacks;
CREATE TABLE Feedbacks (
	Id UNIQUEIDENTIFIER PRIMARY KEY,
	RealtyId UNIQUEIDENTIFIER ,
	Comment NVARCHAR(256),
	Rate INT,
	Moment DATETIME
);

CREATE TABLE AccRates (
	Id UNIQUEIDENTIFIER PRIMARY KEY,
	RealtyId UNIQUEIDENTIFIER,
	AvgRate FLOAT,
	CntRates INT,
	LastRateAt DATETIME
);

INSERT INTO Realties VALUES
(NEWID(), N'Name 1'),
(NEWID(), N'Name 2'),
(NEWID(), N'Name 3'),
(NEWID(), N'Name 4'),
(NEWID(), N'Name 5');

INSERT INTO Realties VALUES
(NEWID(), N'Name 6');

DECLARE @n INT;
SET @n = 1000;
SET NOCOUNT ON;
WHILE @n > 0 
BEGIN
	INSERT INTO Feedbacks VALUES( 
		NEWID(), 
		(SELECT TOP 1 Id FROM Realties ORDER BY NEWID()),
		N'',
		ABS(CHECKSUM(NEWID())) % 5 + 1,
		DATEADD(HOUR, (ABS(CHECKSUM(NEWID())) % 24*365), '2024-01-01')
	);
	SET @n = @n - 1;
END;

SELECT * FROM Feedbacks;

-- перевіряємо роботу тригера
INSERT INTO Feedbacks VALUES( 
	'78F7CFA4-F7DC-463B-AD59-5F33822F19A5', 
	'22E952C1-877C-4854-B662-374DBDF95797',
	N'Added',
	4,
	'2024-10-12 07:08:09'
);
UPDATE Feedbacks SET Rate = 5 WHERE Id = '78F7CFA4-F7DC-463B-AD59-5F33822F19A5';
DELETE FROM Feedbacks WHERE Id = '78F7CFA4-F7DC-463B-AD59-5F33822F19A5';


INSERT INTO Feedbacks VALUES( 
	'5BAAD400-832C-4E5B-803F-41B88CD09799', 
	'22E952C1-877C-4854-B662-374DBDF95797',
	N'Added',
	4,
	'2025-05-08 07:08:09'
);
UPDATE Feedbacks SET Rate = 5 WHERE Id = '5BAAD400-832C-4E5B-803F-41B88CD09799';
DELETE FROM Feedbacks WHERE Id = '5BAAD400-832C-4E5B-803F-41B88CD09799';

SELECT MONTH(CURRENT_TIMESTAMP);